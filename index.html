<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ°´æœOXO</title>
    <style>
        /* ä¿ç•™ä½ ä¹‹å‰çš„æ¨£å¼ä¸¦å„ªåŒ– */
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f5; padding: 20px; }
        .app-container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; }
        .tag { background: #e1f5fe; color: #01579b; padding: 2px 8px; border-radius: 4px; margin-right: 4px; font-size: 12px; }
        .variant-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        select, button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; }
    </style>
</head>
<body>

<div class="app-container">
    <h2 id="userTitle">é›²ç«¯åŒæ­¥å¾Œå°</h2>
    <div id="status">æ­£åœ¨é€£ç·šé›²ç«¯è³‡æ–™åº«...</div>
    
    <label>1. é¸æ“‡æ°´æœ</label>
    <select id="fruitSelect"></select>

    <label style="display:block; margin-top:15px;">2. å‹¾é¸è®Šç•°</label>
    <div id="variantGrid" class="variant-grid"></div>

    <button onclick="uploadData()" style="background:#27ae60; color:white; border:none; cursor:pointer;">ä¸Šå‚³ç´€éŒ„åˆ°é›²ç«¯</button>

    <hr>
    <h3>ğŸ“‹ å…¨åŸŸåŒæ­¥æ¸…å–®</h3>
    <table id="cloudTable">
        <thead><tr><th>ä½¿ç”¨è€…</th><th>æ°´æœ</th><th>è®Šç•°ç‹€æ…‹</th></tr></thead>
        <tbody id="cloudBody"></tbody>
    </table>
</div>

<script>
    // âš ï¸ è«‹åœ¨é€™è£¡è²¼ä¸Šä½ çš„ Apps Script ç¶²å€
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyTvktZusu1atKjQZbzi_dommNgilruZoQvE2Vfwuz1CxY7T_c8JZXBzNppQZLjeKw7/exec";
    
    const fruits = {"ç´…ç¾…è””":"ğŸ¥•","è‰è“":"ğŸ“","è—è“":"ğŸ«","è¥¿ç“œ":"ğŸ‰","å—ç“œ":"ğŸƒ","äººåƒ":"ğŸ¥—","è˜‹æœ":"ğŸ","ç”Ÿèœ":"ğŸ¥¬","æ³¢èœ":"ğŸƒ","ç•ªèŒ„":"ğŸ…","è‘¡è„":"ğŸ‡","ä»™äººæŒ":"ğŸŒµ","æ¤°å­":"ğŸ¥¥","é‡‹è¿¦":"ğŸˆ","ç‰ç±³":"ğŸŒ½","æ¦´æ§¤":"ğŸˆ","èŠ’æœ":"ğŸ¥­","æª¸æª¬":"ğŸ‹","è˜‘è‡":"ğŸ„","ç¢—è±†":"ğŸ«›"};
    const variants = ["é‡‘å…‰", "å½©è™¹", "æ½®æ¿•", "é›»æ“Š", "é¢³é¢¨", "æ²™å¡µ", "æœˆå…‰", "æ¥µå…‰", "éœ²ç ", "ä¹¾ç‡¥", "å¹»è±¡", "ç„¡"];
    const currentUser = sessionStorage.getItem('activeUser') || prompt("è«‹è¼¸å…¥æ‚¨çš„åç¨±") || "å¤©ç«ºé¼ ";
    sessionStorage.setItem('activeUser', currentUser);
    document.getElementById('userTitle').innerText = "ä½ å¥½ï¼Œ" + currentUser;

    function init() {
        const fs = document.getElementById('fruitSelect');
        for (let f in fruits) fs.add(new Option(fruits[f] + " " + f, f));

        const vg = document.getElementById('variantGrid');
        variants.forEach(v => {
            vg.innerHTML += `<label><input type="checkbox" name="vCheck" value="${v}"> ${v}</label>`;
        });
        loadCloudData();
    }

    async function loadCloudData() {
        try {
            const resp = await fetch(SCRIPT_URL);
            const data = await resp.json();
            const tbody = document.getElementById('cloudBody');
            tbody.innerHTML = '';
            data.reverse().forEach(row => {
                tbody.innerHTML += `<tr><td>${row[1]}</td><td>${fruits[row[2]] || ''} ${row[2]}</td><td>${row[3]}</td></tr>`;
            });
            document.getElementById('status').innerText = "âœ… é›²ç«¯é€£ç·šæ­£å¸¸";
        } catch (e) {
            document.getElementById('status').innerText = "âŒ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²å€";
        }
    }

    async function uploadData() {
        const fruit = document.getElementById('fruitSelect').value;
        const selected = Array.from(document.querySelectorAll('input[name="vCheck"]:checked')).map(cb => cb.value);
        if (selected.length === 0) return alert("è«‹å‹¾é¸è®Šç•°");

        document.getElementById('status').innerText = "ğŸš€ ä¸Šå‚³ä¸­...";
        await fetch(SCRIPT_URL, {
            method: "POST",
            body: JSON.stringify({ id: Date.now(), user: currentUser, fruit: fruit, variants: selected })
        });
        
        document.querySelectorAll('input[name="vCheck"]').forEach(cb => cb.checked = false);
        loadCloudData();
    }

    init();
</script>
</body>
</html>
